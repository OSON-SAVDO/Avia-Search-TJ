<!DOCTYPE html>
<html lang="tg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AviaSearch TJ - Чиптаҳои Арзон</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --blue: #0073ff; --orange: #ff6d00; --bg: #f2f5f8; --text: #333; }
        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg); margin: 0; color: var(--text); padding-bottom: 80px; }
        
        /* Header */
        .app-header { background: var(--blue); color: white; padding: 40px 20px 70px; text-align: center; border-radius: 0 0 30px 30px; }
        .app-header h1 { margin: 0; font-size: 24px; letter-spacing: 1px; }

        /* Search Form */
        .search-container { background: white; margin: -50px 15px 20px; border-radius: 20px; padding: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .field { background: #f1f3f6; border-radius: 12px; padding: 12px; margin-bottom: 12px; display: flex; align-items: center; border: 1px solid transparent; }
        .field:focus-within { border-color: var(--blue); background: white; }
        .field i { color: #888; margin-right: 12px; width: 20px; text-align: center; }
        .field input, .field select { border: none; background: transparent; width: 100%; font-size: 16px; outline: none; font-weight: 500; }

        .psg-row { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .psg-box { text-align: center; font-size: 11px; color: #666; }
        .psg-box input { width: 100%; padding: 8px; border-radius: 8px; border: 1px solid #ddd; text-align: center; margin-top: 5px; }

        .search-btn { width: 100%; background: var(--orange); color: white; border: none; padding: 18px; border-radius: 15px; font-size: 18px; font-weight: bold; cursor: pointer; transition: 0.2s; box-shadow: 0 5px 15px rgba(255,109,0,0.3); }
        .search-btn:active { transform: scale(0.98); }

        /* Ticket Card */
        .flight-card { background: white; margin: 15px; border-radius: 20px; padding: 18px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); border: 1px solid #eee; }
        
        .card-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .airline-info { display: flex; align-items: center; gap: 8px; }
        .airline-logo { width: 32px; height: 32px; border-radius: 6px; }
        .airline-name { font-weight: bold; font-size: 14px; color: #555; }
        .price-tag { font-size: 22px; font-weight: 900; color: var(--blue); }

        .route-details { display: flex; justify-content: space-between; align-items: center; margin: 15px 0; }
        .point { flex: 1; }
        .point.right { text-align: right; }
        .code { font-size: 22px; font-weight: 800; display: block; }
        .city { font-size: 12px; color: #888; }
        .time { font-size: 14px; font-weight: bold; margin-top: 4px; display: block; }

        .path-visual { flex: 1.5; text-align: center; padding: 0 10px; position: relative; }
        .duration-text { font-size: 10px; color: #999; margin-bottom: 4px; }
        .line-container { display: flex; align-items: center; justify-content: center; gap: 4px; }
        .dot { width: 6px; height: 6px; background: #ccc; border-radius: 50%; }
        .line { height: 1px; background: #ddd; flex: 1; position: relative; }
        .fa-plane { color: #ccc; font-size: 12px; }

        .card-bottom { display: flex; justify-content: space-between; align-items: center; margin-top: 15px; padding-top: 12px; border-top: 1px dashed #eee; }
        .status-badge { font-size: 11px; padding: 4px 10px; border-radius: 20px; font-weight: 600; }
        .direct { background: #e8f5e9; color: #2e7d32; }
        .transfer { background: #fff3e0; color: #e65100; }
        
        .baggage-info { font-size: 11px; color: #666; display: flex; align-items: center; gap: 4px; }
        .has-bag { color: #2e7d32; }

        .buy-action { display: block; width: 100%; background: #f0f7ff; color: var(--blue); text-align: center; padding: 12px; border-radius: 12px; text-decoration: none; font-weight: bold; margin-top: 15px; transition: 0.3s; }
        .buy-action:hover { background: var(--blue); color: white; }

        /* Filters */
        .filter-scroll { display: flex; overflow-x: auto; padding: 5px 15px; gap: 10px; margin-bottom: 10px; scrollbar-width: none; }
        .filter-item { background: white; border: 1px solid #ddd; padding: 8px 16px; border-radius: 20px; font-size: 13px; white-space: nowrap; cursor: pointer; }
        .filter-item.active { background: var(--blue); color: white; border-color: var(--blue); }

        /* Loading */
        #loader { display: none; text-align: center; padding: 20px; }
    </style>
</head>
<body>

    <div class="app-header">
        <h1>AviaSearch TJ</h1>
    </div>

    <div class="search-container">
        <form action="/search" method="post" id="searchForm">
            <div class="field">
                <i class="fas fa-plane-departure"></i>
                <input type="text" name="from_city" placeholder="Аз куҷо (масалан: Душанбе)" required>
            </div>
            <div class="field">
                <i class="fas fa-plane-arrival"></i>
                <input type="text" name="to_city" placeholder="Ба куҷо (масалан: Москва)" required>
            </div>
            <div class="field">
                <i class="fas fa-calendar-alt"></i>
                <input type="date" name="depart_date" required>
            </div>

            <div class="psg-row">
                <div class="psg-box">Калонсол<input type="number" name="adults" value="1" min="1"></div>
                <div class="psg-box">Кӯдак<input type="number" name="children" value="0" min="0"></div>
                <div class="psg-box">Навзод<input type="number" name="infants" value="0" min="0"></div>
            </div>

            <button type="submit" class="search-btn">ҶУСТУҶӮ</button>
        </form>

        <div id="loader">
            <i class="fas fa-plane fa-spin" style="font-size: 24px; color: var(--blue); margin-bottom: 10px;"></i>
            <p style="font-size: 13px; color: #666;">Нархҳои арзонро меҷӯем...</p>
        </div>
    </div>

    {% if flights %}
    <div class="filter-scroll">
        <div class="filter-item active">Ҳама</div>
        <div class="filter-item">Арзонтарин</div>
        <div class="filter-item">Бе таваққуф</div>
        <div class="filter-item">Бо багаж</div>
    </div>

    <div class="results-list">
        {% for f in flights %}
        <div class="flight-card">
            <div class="card-top">
                <div class="airline-info">
                    <img src="https://pics.avs.io/al_base/64/64/{{ f.airline }}.png" class="airline-logo" alt="logo">
                    <span class="airline-name">{{ f.airline }}</span>
                </div>
                <span class="price-tag">{{ f.price }} TJS</span>
            </div>

            <div class="route-details">
                <div class="point">
                    <span class="code">{{ origin }}</span>
                    <span class="city">Оғоз</span>
                    <span class="time">{{ f.time }}</span>
                </div>

                <div class="path-visual">
                    <div class="duration-text">{{ f.duration // 60 }}с {{ f.duration % 60 }}м</div>
                    <div class="line-container">
                        <div class="dot"></div>
                        <div class="line"></div>
                        <i class="fas fa-plane"></i>
                        <div class="line"></div>
                        <div class="dot"></div>
                    </div>
                    <div class="status-badge {% if f.transfers == 0 %}direct{% else %}transfer{% endif %}" style="margin-top: 8px; display: inline-block;">
                        {% if f.transfers == 0 %}Бе таваққуф{% else %}{{ f.transfers }} таваққуф{% endif %}
                    </div>
                </div>

                <div class="point right">
                    <span class="code">{{ destination }}</span>
                    <span class="city">Расидан</span>
                    <span class="time">--:--</span>
                </div>
            </div>

            <div class="card-bottom">
                <div class="baggage-info {% if f.has_baggage %}has-bag{% endif %}">
                    {% if f.has_baggage %}
                        <i class="fas fa-suitcase"></i> Багаж дорад
                    {% else %}
                        <i class="fas fa-shopping-bag"></i> Танҳо дастбор
                    {% endif %}
                </div>
                <div style="font-size: 11px; color: #999;">Сана: {{ f.date }}</div>
            </div>

            <a href="{{ f.buy_url }}" class="buy-action" target="_blank">ХАРИДАН ДАР AVIASALES</a>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    {% if error %}
    <div style="text-align: center; padding: 20px; color: #e53935;">
        <i class="fas fa-exclamation-circle" style="font-size: 30px; margin-bottom: 10px;"></i>
        <p>{{ error }}</p>
    </div>
    {% endif %}

    <script>
        document.getElementById('searchForm').onsubmit = function() {
            document.querySelector('.search-btn').style.display = 'none';
            document.getElementById('loader').style.display = 'block';
        };
    </script>
</body>
</html>
