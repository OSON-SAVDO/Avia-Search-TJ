<!DOCTYPE html>
<html lang="tg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AviaSearch TJ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --blue: #007bff; --orange: #ff6d00; }
        body { font-family: -apple-system, system-ui, sans-serif; background: #f2f5f8; margin: 0; overflow-x: hidden; }

        /* Splash Screen - Экрани аввалин */
        #splash { position: fixed; top:0; left:0; width:100%; height:100%; background: var(--blue); z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; transition: 0.5s; }
        
        .header-app { background: var(--blue); padding: 30px 15px 60px; text-align: center; color: white; border-radius: 0 0 30px 30px; }
        .header-app h2 { margin: 0; font-size: 20px; font-weight: bold; }

        .search-container { background: white; margin: -40px 15px 20px; border-radius: 20px; padding: 15px; box-shadow: 0 8px 20px rgba(0,0,0,0.1); }
        .field { background: #f1f3f6; border-radius: 12px; padding: 12px; margin-bottom: 10px; display: flex; align-items: center; }
        .field i { color: #888; margin-right: 12px; width: 20px; }
        .field input { border: none; background: transparent; width: 100%; font-size: 16px; outline: none; color: #333; font-weight: 500; }

        .main-btn { width: 100%; background: var(--orange); color: white; border: none; padding: 16px; border-radius: 12px; font-size: 18px; font-weight: bold; cursor: pointer; box-shadow: 0 4px 15px rgba(255,109,0,0.4); }

        /* Натиҷаҳо */
        .card { background: white; margin: 12px; border-radius: 18px; padding: 16px; position: relative; border-left: 4px solid var(--orange); }
        .price-text { font-size: 22px; font-weight: 900; color: var(--blue); }
        .airline-tag { font-size: 12px; font-weight: bold; color: #666; margin-bottom: 8px; display: block; }
        
        .route-info { display: flex; justify-content: space-between; align-items: center; margin: 10px 0; }
        .code { font-size: 20px; font-weight: bold; }
        .sub-text { font-size: 11px; color: #999; }

        .baggage-status { display: inline-flex; align-items: center; gap: 5px; font-size: 11px; padding: 4px 8px; border-radius: 6px; margin-top: 10px; }
        .bag-ok { background: #e8f5e9; color: #2e7d32; }
        .bag-no { background: #fff3e0; color: #e65100; }

        .buy-now { display: block; background: #f0f7ff; color: var(--blue); text-align: center; padding: 12px; border-radius: 10px; text-decoration: none; font-weight: bold; margin-top: 12px; }

        /* Менюи поён */
        .tab-bar { position: fixed; bottom: 0; width: 100%; background: white; display: flex; border-top: 1px solid #eee; padding: 10px 0; z-index: 100; }
        .tab-item { flex: 1; text-align: center; color: #999; text-decoration: none; font-size: 11px; }
        .tab-item.active { color: var(--blue); }
        .tab-item i { font-size: 20px; margin-bottom: 3px; display: block; }
    </style>
</head>
<body onload="closeSplash()">

    <div id="splash">
        <i class="fas fa-plane-departure" style="font-size: 50px; margin-bottom: 20px;"></i>
        <h1 style="font-size: 24px;">AviaSearch TJ</h1>
        <div style="margin-top: 20px;"><i class="fas fa-circle-notch fa-spin"></i></div>
    </div>

    <div class="header-app">
        <h2>Поиск дешёвых билетов</h2>
    </div>

    <div class="search-container">
        <form action="/search" method="post" onsubmit="showLoading()">
            <div class="field">
                <i class="fas fa-map-marker-alt"></i>
                <input type="text" name="from_display" placeholder="Откуда" required>
            </div>
            <div class="field">
                <i class="fas fa-plane-arrival"></i>
                <input type="text" name="to_display" placeholder="Куда" required>
            </div>
            <button type="submit" class="main-btn" id="btnTxt">НАЙТИ БИЛЕТЫ</button>
        </form>
    </div>

    <div id="results">
        {% if flights %}
            {% for f in flights %}
            <div class="card">
                <span class="airline-tag">{{ f.airline }}</span>
                <div class="price-text">{{ f.price }} TJS</div>
                
                <div class="route-info">
                    <div>
                        <span class="code">{{ f.origin_code }}</span>
                        <span class="sub-text">{{ f.from_city }}</span>
                    </div>
                    <div style="text-align: center; color: #ddd;">
                        <i class="fas fa-plane" style="font-size: 12px;"></i>
                        <div class="sub-text" style="color:#28a745">{{ f.type }}</div>
                    </div>
                    <div style="text-align: right;">
                        <span class="code">{{ f.destination_code }}</span>
                        <span class="sub-text">{{ f.to_city }}</span>
                    </div>
                </div>

                <div style="font-size: 12px; color: #444;">
                    <i class="far fa-calendar-alt"></i> {{ f.date }}
                </div>

                <div class="baggage-status {% if f.has_baggage %}bag-ok{% else %}bag-no{% endif %}">
                    {% if f.has_baggage %}
                        <i class="fas fa-suitcase"></i> Багаж включён
                    {% else %}
                        <i class="fas fa-shopping-bag"></i> Без багажа
                    {% endif %}
                </div>

                <a href="{{ f.buy_url }}" class="buy-now" target="_blank">КУПИТЬ БИЛЕТ</a>
            </div>
            {% endfor %}
        {% endif %}
    </div>

    <div class="tab-bar">
        <a href="/" class="tab-item active"><i class="fas fa-search"></i>Поиск</a>
        <a href="#" class="tab-item"><i class="fas fa-heart"></i>Избранное</a>
        <a href="#" class="tab-item"><i class="fas fa-user-circle"></i>Профиль</a>
    </div>

    <script>
        function closeSplash() {
            setTimeout(() => {
                document.getElementById('splash').style.opacity = '0';
                setTimeout(() => { document.getElementById('splash').style.display = 'none'; }, 500);
            }, 1500);
        }

        function showLoading() {
            document.getElementById('btnTxt').innerHTML = '<i class="fas fa-circle-notch fa-spin"></i> ПОИСК...';
        }
    </script>
</body>
</html>
